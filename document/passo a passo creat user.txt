### Como Inserir Novos Usu√°rios e Setores na Nova Tela de Login

Ol√°! Com a nova vers√£o do sistema de login (onde o setor √© determinado automaticamente pelo `username` na tabela `usuario`), o processo de inser√ß√£o de novos usu√°rios mudou um pouco. Agora, ao cadastrar um usu√°rio, voc√™ **n√£o precisa mais selecionar o setor manualmente no login** ‚Äî o sistema consulta o campo `setor` na tabela `usuario` durante a autentica√ß√£o. Isso simplifica o login, mas exige que o setor seja definido corretamente no cadastro.

Vou explicar **passo a passo** como inserir novos usu√°rios e setores. Baseado no seu c√≥digo (como `login.php` e `header.php`), assumo que voc√™ tem acesso ao banco de dados `gm_sicbd` e √† tabela `usuario`. Se voc√™ for **administrador** (setor `administrador`), pode usar a p√°gina `cadastro_usuario.php` (mencionada no menu do header). Caso contr√°rio, fa√ßa via **phpMyAdmin** ou crie uma p√°gina de cadastro.

#### 1. **Pr√©-requisitos**
- **Acesso ao Banco**: Use phpMyAdmin (no XAMPP: http://localhost/phpmyadmin) ou MySQL Workbench.
- **Tabela `usuario`**: Deve ter campos como `username`, `senha` (hashed com `password_hash()`), `setor`, `situacao` (ex: 'ativo'), e outros (ex: `foto`, `email`).
- **Setores V√°lidos**: Baseado no seu `login.php`, setores incluem: `administrador`, `patrimonio`, `financeiro`, `estoque`, `recursos_humanos`, `contratos`, `ccooperacao`, `sisbonde`, `planejamento`, `ocorrencia`, etc. O `setor` deve ser em min√∫sculas.
- **Seguran√ßa**: Sempre hasheie senhas com `password_hash()` e valide entradas para evitar SQL injection.

#### 2. **Inserir um Novo Setor (se necess√°rio)**
Se o setor n√£o existir na lista de op√ß√µes, adicione-o no c√≥digo (em `index.php` para o dropdown antigo, mas agora √© interno). No entanto, o setor √© armazenado como texto na tabela `usuario`, ent√£o n√£o precisa de tabela separada ‚Äî basta inserir o valor correto.

- **Via phpMyAdmin**:
  1. Acesse phpMyAdmin > Banco `gm_sicbd` > Tabela `usuario`.
  2. Ao inserir um usu√°rio, defina o campo `setor` com o nome desejado (ex: `novo_setor`).
  3. Para adicionar ao menu (header.php), edite o switch em `header.php` para incluir o novo setor.

- **Via C√≥digo (Atualize `header.php`)**:
  Adicione o case no switch de `$menuItens`:
  ```php
  case 'novo_setor':
      $menuItens = [
          ['link' => 'painel_novo.php', 'nome' => 'Painel Novo Setor', 'icon' => 'home'],
          // Outros itens...
      ];
      break;
  ```

#### 3. **Inserir um Novo Usu√°rio**
Existem duas formas: **via p√°gina web** (recomendado para admins) ou **direto no banco**.

##### **Op√ß√£o A: Via P√°gina Web (Usando `cadastro_usuario.php`)**
Se voc√™ tem a p√°gina `cadastro_usuario.php` (mencionada no header para admins), ela deve ser similar ao abaixo. Se n√£o existir, crie-a:

- **Crie `cadastro_usuario.php`** (salve no diret√≥rio raiz):
  ```php
  <?php
  session_start();
  include 'banco.php'; // Sua conex√£o com o banco (mysqli ou PDO)

  // Verifica se √© admin
  if (!isset($_SESSION['setor']) || $_SESSION['setor'] !== 'administrador') {
      header("Location: index.php");
      exit;
  }

  $erro = '';
  $sucesso = '';

  if ($_SERVER['REQUEST_METHOD'] == 'POST') {
      $username = trim($_POST['username']);
      $senha = $_POST['senha'];
      $confirmar_senha = $_POST['confirmar_senha'];
      $setor = strtolower(trim($_POST['setor']));
      $situacao = 'ativo'; // Padr√£o

      // Valida√ß√µes b√°sicas
      if (empty($username) || empty($senha) || empty($setor)) {
          $erro = 'Todos os campos s√£o obrigat√≥rios.';
      } elseif ($senha !== $confirmar_senha) {
          $erro = 'Senhas n√£o coincidem.';
      } elseif (strlen($senha) < 6) {
          $erro = 'Senha deve ter pelo menos 6 caracteres.';
      } else {
          // Verifica se username j√° existe
          $stmt = $con->prepare("SELECT id FROM usuario WHERE username = ?");
          $stmt->bind_param("s", $username);
          $stmt->execute();
          if ($stmt->get_result()->num_rows > 0) {
              $erro = 'Username j√° existe.';
          } else {
              // Hashea a senha
              $senha_hash = password_hash($senha, PASSWORD_DEFAULT);

              // Insere o usu√°rio
              $stmt = $con->prepare("INSERT INTO usuario (username, senha, setor, situacao) VALUES (?, ?, ?, ?)");
              $stmt->bind_param("ssss", $username, $senha_hash, $setor, $situacao);
              if ($stmt->execute()) {
                  $sucesso = 'Usu√°rio cadastrado com sucesso!';
              } else {
                  $erro = 'Erro ao cadastrar: ' . $con->error;
              }
          }
          $stmt->close();
      }
  }

  // Lista de setores dispon√≠veis (baseado no seu login.php)
  $setores = [
      'administrador', 'patrimonio', 'financeiro', 'estoque', 'recursos_humanos',
      'contratos', 'ccooperacao', 'sisbonde', 'planejamento', 'ocorrencia'
  ];
  ?>

  <!DOCTYPE html>
  <html lang="pt-BR">
  <head>
      <meta charset="UTF-8">
      <title>Cadastro de Usu√°rio</title>
      <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
      <!-- Seu CSS aqui -->
  </head>
  <body>
      <div class="container mt-5">
          <h2>Cadastro de Novo Usu√°rio</h2>
          <?php if ($erro): ?>
              <div class="alert alert-danger"><?php echo $erro; ?></div>
          <?php endif; ?>
          <?php if ($sucesso): ?>
              <div class="alert alert-success"><?php echo $sucesso; ?></div>
          <?php endif; ?>

          <form method="POST">
              <div class="form-group mb-3">
                  <label>Username:</label>
                  <input type="text" name="username" class="form-control" required>
              </div>
              <div class="form-group mb-3">
                  <label>Senha:</label>
                  <input type="password" name="senha" class="form-control" required minlength="6">
              </div>
              <div class="form-group mb-3">
                  <label>Confirmar Senha:</label>
                  <input type="password" name="confirmar_senha" class="form-control" required>
              </div>
              <div class="form-group mb-3">
                  <label>Setor:</label>
                  <select name="setor" class="form-control" required>
                      <option value="">Selecione o setor</option>
                      <?php foreach ($setores as $s): ?>
                          <option value="<?php echo $s; ?>"><?php echo ucfirst($s); ?></option>
                      <?php endforeach; ?>
                  </select>
              </div>
              <button type="submit" class="btn btn-primary">Cadastrar</button>
              <a href="painel.php" class="btn btn-secondary">Voltar</a>
          </form>
      </div>
  </body>
  </html>
  ```

- **Como usar**:
  1. Logue como admin.
  2. Acesse `cadastro_usuario.php` (adicione ao menu se necess√°rio).
  3. Preencha e submeta ‚Äî o usu√°rio √© inserido com setor definido.

##### **Op√ß√£o B: Direto no Banco (phpMyAdmin)**
1. Acesse phpMyAdmin > Banco `gm_sicbd` > Tabela `usuario` > **Inserir**.
2. Preencha os campos:
   - `username`: Nome √∫nico (ex: `novo_user`).
   - `senha`: Senha hasheada (gere com PHP: `echo password_hash('senha123', PASSWORD_DEFAULT);` ‚Äî cole o hash).
   - `setor`: Nome do setor em min√∫sculas (ex: `financeiro`).
   - `situacao`: `ativo`.
   - Outros campos opcionais (ex: `foto` = null).
3. Clique **Executar** ‚Äî pronto! O usu√°rio pode logar com username e senha.

#### 4. **Atualizar Setor de Usu√°rio Existente**
- **Via phpMyAdmin**: Edite a tabela `usuario` > Selecione o usu√°rio > Altere `setor`.
- **Via C√≥digo**: Crie `editar_usuario.php` similar ao cadastro, com UPDATE:
  ```php
  $stmt = $con->prepare("UPDATE usuario SET setor = ? WHERE username = ?");
  $stmt->bind_param("ss", $novo_setor, $username);
  $stmt->execute();
  ```

#### 5. **Melhores Pr√°ticas de Seguran√ßa**
- **Hash de Senha**: Sempre use `password_hash($senha, PASSWORD_DEFAULT)` e `password_verify()` (como no seu `login.php`).
- **Valida√ß√£o**: Verifique username √∫nico, senha forte (m√≠n. 8 chars, mai√∫scula/min√∫scula/n√∫mero).
- **Sanitiza√ß√£o**: Use prepared statements para evitar SQL injection (como no exemplo).
- **Email Confirma√ß√£o**: Adicione envio de email para ativar conta.
- **Limite de Tentativas**: No login, implemente bloqueio ap√≥s 3 erros.

#### 6. **Teste o Cadastro**
1. Cadastre um usu√°rio teste (ex: username `teste`, senha `123456`, setor `estoque`).
2. Logue com ele ‚Äî o sistema deve detectar o setor automaticamente e redirecionar para a p√°gina correta (ex: `painelalmoxarifado.php` para `estoque`).

Se precisar do c√≥digo completo de `cadastro_usuario.php` ou ajustes (ex: adicionar email/foto), me avise! Para setores novos, atualize o `getRedirectionPage()` em `login.php`. Qualquer erro, compartilhe o log. üòä